# Задание: Сервис обработки задач на Go

## Основные требования

### 1. Прием заданий

- Метод: `POST /enqueue`
- Тело запроса: 

```json
{
  "id": "<string>",
  "payload": "<string>",
  "max_retries": <int>
}
````

* Задания помещаются в **буферизированную очередь**. Размер очереди задается через конфигурацию (`QUEUE_SIZE`).
* Авторизация **не требуется**.

---

### 2. Обработка заданий

* Используется **пул воркеров** (`WORKERS` настраивается через окружение, по умолчанию 4).
* Каждое задание выполняется **100–500 мс** (симуляция работы).
* **20% задач «падают»**, чтобы симулировать ошибки.
    * Применяется **экспоненциальный бэкофф с джиттером**.
    * Количество повторов ограничено полем `max_retries`.
* Состояние задачи хранится и обновляется:
    * `queued` — в очереди
    * `running` — выполняется
    * `done` — успешно завершено
    * `failed` — после всех попыток не выполнено

---

### 3. Healthcheck

* Метод: `GET /healthz`
* Ответ: `200 OK`

---

### 4. Завершение программы

* Обработка сигналов `SIGINT` / `SIGTERM`
    * Прекращаем принимать новые задания
    * Дожидаемся завершения текущих задач

---

## Ограничения

* Go версии **1.24, без сторонних библиотек**
* Конфигурация через переменные окружения:
    * `WORKERS` (по умолчанию 4)
    * `QUEUE_SIZE` (по умолчанию 64)
* Краткий рассказ решения в `README.md` или в комментариях к коду

## Структура проекта

Проект организован в соответствии с принципами чистой архитектуры и разделением ответственности:

### cmd/server
- `server.go` — точка входа приложения, настраивает HTTP-сервер, роуты и сигналы завершения.

### internal/config
- `flags.go` — загрузка конфигурации из переменных окружения и флагов.

### internal/handlers
- `handlers.go` — обработчики HTTP-запросов: `POST /enqueue`, `GET /healthz`.

### internal/logger
- `logger.go` — простой логгер с уровнями `DEBUG`, `INFO`, `ERROR`.

### internal/models
- `tasks.go` — структура задачи и состояния (`queued | running | done | failed`).

### internal/repository
- `queue.go` — буферизированная очередь задач.  
- `storage.go` — хранилище состояния задач и управление повторными попытками.

### internal/service
- `worker.go` — пул воркеров, обработка задач с симуляцией выполнения, обработка ошибок и экспоненциальный бэкофф.

Каждый модуль отделяет конкретную ответственность: конфигурация, логирование, обработка HTTP, хранение данных и выполнение задач.  
Это делает проект легко поддерживаемым, расширяемым и легко адаптируемым к написанию автотестов.

